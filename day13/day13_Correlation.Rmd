---
title: "day13 Correlation"
author: "Sung Inkyung"
date: '2021 6 5 '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(tidytext)
library(widyr)
library(igraph)
library(ggraph)
```


  
```{r}
bible <- read.csv("C:/Users/inkyscope/Documents/projectR/inkyscroll/data/bible_kjv_new.csv")

ephesians <- read.csv("C:/Users/inkyscope/Documents/projectR/inkyscroll/data/Ephesians_Books.csv")

eph_stopwords <- c("ye", "god", "thou", "thy", "hath", "thee", "hast", "shalt", "thine", "yea", "art", "till", "fro", "nay", "saith")


df_books <- bible %>% 
  inner_join(ephesians, by = c("book", "chapter", "verse")) %>% 
  select(book, text) %>% 
  unnest_tokens(word, text) %>% 
  filter(!word %in% eph_stopwords) %>% 
  anti_join(stop_words, by = "word") %>% 
  count(book, word, sort = T) %>% 
  bind_tf_idf(word, book, n) %>% 
  #slice_max(n = 2000, order_by= tf_idf) %>% 
  mutate(tf_idf = round(tf_idf * n, 2))

set.seed(123)

plot_books <- df_books %>% 
  pairwise_cor(book, word, tf_idf, sort = T) %>% 
  filter(correlation >= 0.05) %>% 
  graph_from_data_frame() %>% 
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation),
                 show.legend = F) +
  geom_node_point(color = "#c3272b",
                  size = 3.5) +
  geom_node_text(aes(label = name),
                 hjust = .5,
                 repel = T) +
  labs(title = "Coocurring Books with Book of Ephesians",
       subtitle = "List of books are cross-referenced during the preaching of Ephesians\ndelivered by Pastor Cho JungMin from  November 22, 2020 to March 7th, 2021\nat Basic Church",
       caption = "Source: #30DayChartChallenge | Graphic: Sung Inkyung") +
  theme_void() +
  theme(plot.title = element_text(size = 16),
        plot.subtitle = element_text(size = 13),
        plot.caption = element_text(size = 9))

ggsave(here::here("day13", "day13_Correlation.png"))


```



